{% extends 'lead-maker/accounts/base.html' %}
{% block content %}
{% load static %}
{% include "lead-maker/includes/header.html" %}




<main class="content contain">
        <section class="login-sec voice-subtitle">
            <div class="container">
                <ul class="status-bar">
                    <li class="active loading loaded"><a href="#!">Upload & Customise</a></li>
                    <li class="active loading loaded"><a href="#!">Lead Creation</a></li>
                    <li class="active loading loaded"><a href="#!">Background Music Selection</a></li>
                    <li class="active"><a href="#!">Download</a></li>
                </ul>
                <div class="lead-container">
                    <h5 class="text-center lead-title">Your Video Has Been Generated Successfully</h5>
                    <div class="video-container">
                        <video height="400"  controls>
                            <source src="{{ text_file.generated_watermarked_video.url }}"
                            type="video/mp4" />
    
                                Your browser does not support the video tag.
                        </video> 
                    </div>
                    {% if bg_music == 'false' %}
                    
                    

                     <a href="{% url 'video_text:download_file' file_key=text_file.generated_final_bgm_video.name textfile_id=text_file.id %}"  class="btn proceed-btn" id="download">
                        Download
                        <img class="btn-arrow" src="{% static 'lead-maker/images/download-icn.svg' %}" alt="Download Arrow" />
                        </a> 
                        {%else %}
                        <a  href="{% url 'video_text:download_file' file_key=text_file.generated_final_bgm_video.name textfile_id=text_file.id %}" class="btn proceed-btn" id="download">
                           Download
                           <img class="btn-arrow" src="{% static 'lead-maker/images/download-icn.svg' %}" alt="Download Arrow" />
                           </a> 
                           {% endif %}
                    <p style="margin-top: 13px; font-size: 12px; color: black">
                        *Please Note The Watermark Will Be Removed When You Click Download
                    </p>
                </div>
                
            </div>
        </section>
    </main>

    
<script>


</script>
    <!-- <script src="{% static 'lead-maker/js/downloads.js' %}"></script> external JS file -->

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
<script>
    
    document.getElementById('download').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default anchor behavior

            if ('{{ request.user.subscription.plan.name }}' == 'free') {
              document.querySelector('.plans-popup-container').classList.remove('hidden');
            } else {
              // Fetch the URL to start the download
              const href = event.currentTarget.getAttribute('href');

              fetch(href)
                .then(response => {
                  if (response.ok) {
                    // Create a temporary link to trigger the download
                    const tempLink = document.createElement('a');
                    tempLink.href = href;
                    tempLink.setAttribute('download', 'videocrafter.mp4');
                    document.body.appendChild(tempLink);
                    tempLink.click();
                    document.body.removeChild(tempLink);

                    // After the download starts, redirect to /text
                    window.location.href = '/text';
                  } else {
                    console.error('Download failed or could not start.');
                  }
                })
                .catch(error => {
                  console.error('Error initiating the download:', error);
                });
            }
          });
        
</script>


{% endblock content %}